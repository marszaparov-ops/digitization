<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>–¶–∏—Ñ—Ä–æ–≤–æ–π –ê—Ä—Ö–∏–≤</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #f0f2f5; display: flex; flex-direction: column; height: 100vh; }

        /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
        .header { background: #2196F3; color: white; padding: 10px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–±–ª–∏—Ü—ã —Å –ø–æ–ª–∑—É–Ω–∫–æ–º */
        .main-content { flex: 1; padding: 20px; overflow: hidden; display: flex; flex-direction: column; }
        .table-wrapper { flex: 1; overflow-y: auto; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }

        table { width: 100%; border-collapse: collapse; }
        th { position: sticky; top: 0; background: #1976D2; color: white; padding: 15px; text-align: left; z-index: 2; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        tr:hover { background: #f9f9f9; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; text-decoration: none; }
        .btn-add { background: #4CAF50; color: white; margin-bottom: 15px; display: inline-block; }
        .btn-scan { background: #ff9800; color: white; padding: 8px 15px; display: flex; align-items: center; gap: 5px; }
        .btn-delete { background: #f44336; color: white; padding: 5px 10px; font-size: 0.8em; }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); }
        .modal-content { background: white; margin: 5% auto; padding: 25px; width: 450px; border-radius: 10px; position: relative; }

        /* –û–∫–Ω–æ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (—à–∏—Ä–µ) */
        .preview-content { width: 80%; height: 85%; margin: 2% auto; }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        .file-row { display: flex; gap: 10px; align-items: center; }
    </style>
</head>
<body>

<div class="header">
    <h2>üìÇ –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –ê—Ä—Ö–∏–≤</h2>
    <div>
        <span sec:authentication="name">User</span>
        <a href="/logout" style="color: white; margin-left: 15px;">–í—ã—Ö–æ–¥</a>
    </div>
</div>

<div class="main-content">
    <div>
        <button class="btn btn-add" onclick="toggleModal('uploadModal', true)">+ –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>‚Ññ –î–æ–∫.</th>
                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                <th sec:authorize="hasRole('ADMIN')">–î–µ–π—Å—Ç–≤–∏–µ</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="doc : ${documents}">
                <td th:text="${doc.id}"></td>
                <td th:text="${doc.docNumber}"></td>
                <td>
                    <a href="javascript:void(0);" th:onclick="'showPreview(\'/archive/download/' + ${doc.id} + '\')'"
                       th:text="${doc.title}" style="color: #2196F3; text-decoration: none; font-weight: bold;"></a>
                </td>
                <td th:text="${doc.category}"></td>
                <td sec:authorize="hasRole('ADMIN')">
                    <form th:action="@{/archive/delete/{id}(id=${doc.id})}" method="post" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å?');">
                        <button class="btn btn-delete">–£–¥–∞–ª–∏—Ç—å</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

<div id="uploadModal" class="modal">
    <div class="modal-content">
        <h3>–ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</h3>
        <form th:action="@{/archive/upload}" method="post" enctype="multipart/form-data">
            <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input type="text" name="title" required></div>
            <div class="form-group"><label>–ù–æ–º–µ—Ä</label><input type="text" name="docNumber"></div>
            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select name="category">
                    <option value="–î–æ–≥–æ–≤–æ—Ä">–î–æ–≥–æ–≤–æ—Ä</option>
                    <option value="–ü—Ä–∏–∫–∞–∑">–ü—Ä–∏–∫–∞–∑</option>
                    <option value="–ü–∏—Å—å–º–æ">–ü–∏—Å—å–º–æ</option>
                </select>
            </div>
            <div class="form-group">
                <label>–§–∞–π–ª / –°–∫–∞–Ω–µ—Ä</label>
                <div class="file-row">
                    <input type="file" name="file">
                    <a href="/archive/scan-refresh" class="btn btn-scan">üñ®Ô∏è –°–∫–∞–Ω</a>
                </div>
            </div>
            <button type="submit" class="btn btn-add" style="width:100%">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button type="button" onclick="toggleModal('uploadModal', false)" style="width:100%; background:#ccc;" class="btn">–û—Ç–º–µ–Ω–∞</button>
        </form>
    </div>
</div>

<div id="previewModal" class="modal">
    <div class="modal-content preview-content">
        <button onclick="toggleModal('previewModal', false)" style="float:right" class="btn btn-delete">–ó–∞–∫—Ä—ã—Ç—å</button>
        <iframe id="previewFrame" src="" style="width:100%; height:95%; border:none; margin-top:10px;"></iframe>
    </div>
</div>

<script>
    function toggleModal(id, show) {
        document.getElementById(id).style.display = show ? 'block' : 'none';
    }
    function showPreview(url) {
        document.getElementById('previewFrame').src = url;
        toggleModal('previewModal', true);
    }
</script>

</body>
</html>