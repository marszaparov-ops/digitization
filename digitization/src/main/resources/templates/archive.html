<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Архив документов</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 40px; background-color: #f4f7f6; }
        .nav { margin-bottom: 20px; display: flex; justify-content: space-between; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #2196F3; color: white; }
        .upload-box { background: white; padding: 25px; border-radius: 8px; margin-top: 30px; width: 450px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        input, select, textarea, button { display: block; width: 100%; margin-bottom: 15px; padding: 10px; box-sizing: border-box; }
        button { background: #2196F3; color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-delete { background: #ff4d4d; width: auto; padding: 5px 10px; margin: 0; }
        .role-badge { font-size: 0.8em; padding: 3px 8px; border-radius: 10px; background: #eee; }
    </style>
</head>
<body>

<div class="nav">
    <div>
        <a sec:authorize="hasRole('ADMIN')" href="/admin/users">⚙️ Управление пользователями</a>
    </div>
    <div>
            <span>Вы вошли как: <b sec:authentication="name">User</b>
            <span class="role-badge" sec:authentication="principal.authorities">Role</span></span>
        <a href="/logout" style="margin-left: 15px; color: red;">Выйти</a>
    </div>
</div>

<h2>Архив электронных документов</h2>

<table>
    <thead>
    <tr>
        <th>ID</th>
        <th>№ Док.</th>
        <th>Название (скачать)</th>
        <th>Категория</th>
        <th sec:authorize="hasRole('ADMIN')">Действие</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="doc : ${documents}">
        <td th:text="${doc.id}"></td>
        <td th:text="${doc.docNumber}"></td>
        <td>
            <a th:href="@{/archive/download/{id}(id=${doc.id})}" th:text="${doc.title}" style="color: #2196F3; font-weight: bold; text-decoration: none;"></a>
        </td>
        <td th:text="${doc.category}"></td>
        <td sec:authorize="hasRole('ADMIN')">
            <form th:action="@{/archive/delete/{id}(id=${doc.id})}" method="post" onsubmit="return confirm('Удалить документ?');">
                <button type="submit" class="btn-delete">Удалить</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<div class="upload-box" sec:authorize="hasAnyRole('ADMIN', 'USER')">
    <h3>➕ Загрузить новый документ</h3>
    <form th:action="@{/archive/upload}" method="post" enctype="multipart/form-data">
        <input type="text" name="title" placeholder="Название (напр. Скан договора)" required>
        <input type="text" name="docNumber" placeholder="Номер документа (напр. №001)">

        <select name="category">
            <option value="Приказ">Приказ</option>
            <option value="Договор">Договор</option>
            <option value="Письмо">Входящее письмо</option>
            <option value="Другое">Другое</option>
        </select>

        <textarea name="description" placeholder="Краткое описание"></textarea>
        <input type="file" name="file" required>
        <button type="submit">Добавить в архив</button>
    </form>
</div>

</body>
</html>